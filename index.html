<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solana Radar - Whale Analysis Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 40px; }
        h1 { font-size: 2.5rem; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .subtitle { font-size: 1.1rem; opacity: 0.9; }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .stat-card h3 {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .stat-value { font-size: 2.5rem; font-weight: bold; }
        .stat-label { font-size: 0.85rem; opacity: 0.7; margin-top: 5px; }
        .chart-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .chart-title { font-size: 1.3rem; margin-bottom: 20px; }
        .charts-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        canvas { max-height: 300px; }
        .filters, .export-toolbar {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        .filter-group { display: flex; flex-direction: column; gap: 5px; }
        .filter-group label { font-size: 0.85rem; opacity: 0.8; }
        select, input {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.15);
            color: #fff;
            font-size: 0.9rem;
        }
        select option { background: #764ba2; color: #fff; }
        .btn {
            padding: 10px 20px;
            border-radius: 10px;
            border: none;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-primary { background: #3b82f6; color: white; }
        .btn-primary:hover { background: #2563eb; transform: translateY(-2px); }
        .btn-success { background: #10b981; color: white; }
        .btn-success:hover { background: #059669; transform: translateY(-2px); }
        .btn-secondary { background: rgba(255, 255, 255, 0.2); color: white; }
        .btn-secondary:hover { background: rgba(255, 255, 255, 0.3); }
        .table-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            overflow-x: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .table-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .results-count { font-size: 0.9rem; opacity: 0.8; }
        table { width: 100%; border-collapse: collapse; }
        th {
            text-align: left;
            padding: 15px 10px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            font-weight: 600;
            cursor: pointer;
            user-select: none;
        }
        th:hover { background: rgba(255, 255, 255, 0.1); }
        td { padding: 12px 10px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
        tr:hover { background: rgba(255, 255, 255, 0.05); }
        .risk-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        .risk-extreme { background: #ef4444; }
        .risk-high { background: #f59e0b; }
        .risk-medium { background: #eab308; }
        .risk-low { background: #10b981; }
        .momentum-badge { display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 0.75rem; font-weight: 600; }
        .momentum-hot { background: #ef4444; animation: pulse 2s infinite; }
        .momentum-warming { background: #f59e0b; }
        .momentum-cooling { background: #3b82f6; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .loading { text-align: center; padding: 50px; font-size: 1.2rem; }
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s;
            z-index: 10000;
        }
        .toast.show { opacity: 1; transform: translateY(0); }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 3% auto;
            padding: 0;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            width: 90%;
            max-width: 1200px;
            max-height: 85vh;
            overflow-y: auto;
        }
        .modal-header {
            padding: 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-title { font-size: 1.8rem; font-weight: bold; }
        .modal-subtitle { font-size: 0.9rem; opacity: 0.8; margin-top: 5px; }
        .close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        .close-btn:hover { background: rgba(255, 255, 255, 0.3); transform: rotate(90deg); }
        .modal-body { padding: 30px; }
        .modal-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .modal-stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .modal-stat-label { font-size: 0.75rem; opacity: 0.7; text-transform: uppercase; }
        .modal-stat-value { font-size: 1.5rem; font-weight: bold; margin-top: 5px; }
        .modal-chart-container { background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 20px; margin-bottom: 20px; }
        .modal-chart-title { font-size: 1.1rem; margin-bottom: 15px; font-weight: 600; }
        .alert-box {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .alert-box.warning { background: rgba(245, 158, 11, 0.2); border-color: #f59e0b; }
        .alert-box.info { background: rgba(59, 130, 246, 0.2); border-color: #3b82f6; }
        .clickable-row { cursor: pointer; }
        .clickable-row:hover { background: rgba(255, 255, 255, 0.1) !important; }
        @media (max-width: 768px) {
            .charts-row { grid-template-columns: 1fr; }
            h1 { font-size: 1.8rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîç Solana Radar</h1>
            <p class="subtitle">Real-time Whale Activity & Volume Momentum Analysis</p>
        </header>
        
        <div class="stats-grid">
            <div class="stat-card">
                <h3>Total Tokens</h3>
                <div class="stat-value" id="totalTokens">-</div>
                <div class="stat-label">Being tracked</div>
            </div>
            <div class="stat-card">
                <h3>Extreme Risk</h3>
                <div class="stat-value" id="extremeRisk">-</div>
                <div class="stat-label">99%+ concentration</div>
            </div>
            <div class="stat-card">
                <h3>Safe Tokens</h3>
                <div class="stat-value" id="safeTokens">-</div>
                <div class="stat-label">Low/Medium risk</div>
            </div>
            <div class="stat-card">
                <h3>Hot Tokens üî•</h3>
                <div class="stat-value" id="hotTokens">-</div>
                <div class="stat-label">High volume momentum</div>
            </div>
            <div class="stat-card">
                <h3>Avg Concentration</h3>
                <div class="stat-value" id="avgConcentration">-</div>
                <div class="stat-label">Top 10 holders</div>
            </div>
        </div>
        
        <div class="charts-row">
            <div class="chart-container">
                <h2 class="chart-title">Risk Distribution</h2>
                <canvas id="riskChart"></canvas>
            </div>
            <div class="chart-container">
                <h2 class="chart-title">Volume Momentum</h2>
                <canvas id="momentumChart"></canvas>
            </div>
        </div>
        
        <div class="chart-container">
            <h2 class="chart-title">Concentration vs Volume (with Momentum)</h2>
            <canvas id="concentrationChart"></canvas>
        </div>
        
        <div class="chart-container">
            <h2 class="chart-title">üìä 7-Day Performance Leaders</h2>
            <canvas id="performanceChart"></canvas>
        </div>
        
        <div class="chart-container" id="patternsSection" style="display: none;">
            <h2 class="chart-title">üéØ Active Patterns</h2>
            <div id="patternsContent" style="font-size: 0.95rem;"></div>
        </div>
        
        <div class="filters">
            <div class="filter-group">
                <label>Risk Level</label>
                <select id="riskFilter">
                    <option value="all">All Risks</option>
                    <option value="extreme">Extreme</option>
                    <option value="high">High</option>
                    <option value="medium">Medium</option>
                    <option value="low">Low</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Momentum</label>
                <select id="momentumFilter">
                    <option value="all">All</option>
                    <option value="hot">üî• Hot</option>
                    <option value="warming">üìà Warming</option>
                    <option value="cooling">üìâ Cooling</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Min Liquidity ($)</label>
                <input type="number" id="liquidityFilter" placeholder="0" min="0">
            </div>
            <div class="filter-group">
                <label>Search Token</label>
                <input type="text" id="searchFilter" placeholder="Symbol or name...">
            </div>
        </div>
        
        <div class="export-toolbar">
            <span style="font-size: 0.9rem; opacity: 0.8;">üì• Export:</span>
            <button class="btn btn-primary" onclick="exportCSV()">üìÑ CSV</button>
            <button class="btn btn-success" onclick="exportJSON()">üì¶ JSON</button>
            <button class="btn btn-secondary" onclick="copyTable()">üìã Copy</button>
            <span class="results-count" id="exportCount"></span>
        </div>
        
        <div class="table-container">
            <div class="table-header">
                <h2 class="chart-title">Token Leaderboard</h2>
                <span class="results-count" id="resultsCount">Loading...</span>
            </div>
            <div id="loading" class="loading">Loading data...</div>
            <table id="tokenTable" style="display: none;">
                <thead>
                    <tr>
                        <th onclick="sortTable('symbol')">Symbol</th>
                        <th onclick="sortTable('name')">Name</th>
                        <th onclick="sortTable('top_10_holders_pct')">Top 10%</th>
                        <th onclick="sortTable('concentration_risk')">Risk</th>
                        <th onclick="sortTable('volume_24h_usd')">Volume</th>
                        <th onclick="sortTable('vol_mom_3v1')">Momentum</th>
                        <th onclick="sortTable('liquidity_usd')">Liquidity</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>
    
    <div id="tokenModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div>
                    <div class="modal-title" id="modalTitle">Token History</div>
                    <div class="modal-subtitle" id="modalSubtitle">Loading...</div>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-secondary" onclick="exportModalCSV()">üì• Export</button>
                    <button class="close-btn" onclick="closeModal()">&times;</button>
                </div>
            </div>
            <div class="modal-body">
                <div id="modalAlerts"></div>
                <div class="modal-stats" id="modalStats"></div>
                <div class="modal-chart-container">
                    <h3 class="modal-chart-title">Holder Concentration Over Time</h3>
                    <canvas id="modalConcentrationChart"></canvas>
                </div>
                <div class="modal-chart-container">
                    <h3 class="modal-chart-title">Price & Volume History</h3>
                    <canvas id="modalPriceVolumeChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <div id="toast" class="toast"></div>
    
    <script>
let allTokens=[];let filteredTokens=[];let sortColumn='volume_24h_usd';let sortAscending=false;let fullHistoryData=[];let modalCharts={};let currentModalAddress=null;const historyUrl='https://raw.githubusercontent.com/stelios5791/sol-reports/main/data/history.csv';const performanceUrl='https://raw.githubusercontent.com/stelios5791/sol-reports/main/data/performance.csv';let dataLoaded={history:false,performance:false};let performanceData=[];

Papa.parse(historyUrl,{download:true,header:true,dynamicTyping:true,skipEmptyLines:true,complete:function(r){if(r.data&&r.data.length>0){fullHistoryData=r.data.filter(row=>row.address&&row.date);const g={};fullHistoryData.forEach(row=>{if(row.concentration_risk){const a=row.address;const d=new Date(row.date);if(!g[a]||new Date(g[a].date)<d){g[a]=row}}});allTokens=Object.values(g)}dataLoaded.history=true;checkDataLoaded()},error:function(){dataLoaded.history=true;checkDataLoaded()}});

Papa.parse(performanceUrl,{download:true,header:true,dynamicTyping:true,skipEmptyLines:true,complete:function(r){if(r.data&&r.data.length>0){const g={};r.data.forEach(row=>{if(row.address&&row.date){const a=row.address;const d=new Date(row.date);if(!g[a]||new Date(g[a].date)<d){g[a]=row}}});performanceData=Object.values(g)}dataLoaded.performance=true;checkDataLoaded()},error:function(){dataLoaded.performance=true;checkDataLoaded()}});

function checkDataLoaded(){if(dataLoaded.history&&dataLoaded.performance){mergeDataAndInit()}}

function mergeDataAndInit(){const perfMap={};performanceData.forEach(p=>{perfMap[p.address]=p});allTokens=allTokens.map(token=>{const perf=perfMap[token.address]||{};let momentumLabel='cooling';const mom3v1=perf.vol_mom_3v1||0;if(mom3v1>2)momentumLabel='hot';else if(mom3v1>1)momentumLabel='warming';return{...token,vol_mom_3v1:perf.vol_mom_3v1,zscore_vol_10d:perf.zscore_vol_10d,presence_7d:perf.presence_7d,presence_30d:perf.presence_30d,vol_momentum:momentumLabel}});filteredTokens=[...allTokens];initDashboard();setTimeout(()=>{createPerformanceChart();detectPatterns()},500)}

function initDashboard(){updateStats();createCharts();renderTable();setupFilters();document.getElementById('loading').style.display='none';document.getElementById('tokenTable').style.display='table'}

function updateStats(){const total=allTokens.length;const extreme=allTokens.filter(t=>t.concentration_risk==='extreme').length;const safe=allTokens.filter(t=>['low','medium'].includes(t.concentration_risk)).length;const hot=allTokens.filter(t=>t.vol_momentum==='hot').length;const validConc=allTokens.map(t=>t.top_10_holders_pct).filter(v=>v!=null&&!isNaN(v));const avgConc=validConc.length>0?(validConc.reduce((sum,v)=>sum+v,0)/validConc.length).toFixed(1):'0.0';document.getElementById('totalTokens').textContent=total;document.getElementById('extremeRisk').textContent=extreme;document.getElementById('safeTokens').textContent=safe;document.getElementById('hotTokens').textContent=hot;document.getElementById('avgConcentration').textContent=avgConc+'%'}

function createCharts(){const riskCounts={extreme:0,high:0,medium:0,low:0,unknown:0};allTokens.forEach(t=>{const risk=t.concentration_risk||'unknown';if(risk in riskCounts)riskCounts[risk]++});new Chart(document.getElementById('riskChart'),{type:'doughnut',data:{labels:['Extreme','High','Medium','Low','Unknown'],datasets:[{data:[riskCounts.extreme,riskCounts.high,riskCounts.medium,riskCounts.low,riskCounts.unknown],backgroundColor:['#ef4444','#f59e0b','#eab308','#10b981','#6b7280']}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{labels:{color:'#fff'}}}}});const momentumCounts={hot:allTokens.filter(t=>t.vol_momentum==='hot').length,warming:allTokens.filter(t=>t.vol_momentum==='warming').length,cooling:allTokens.filter(t=>t.vol_momentum==='cooling').length};new Chart(document.getElementById('momentumChart'),{type:'bar',data:{labels:['üî• Hot','üìà Warming','üìâ Cooling'],datasets:[{label:'Tokens',data:[momentumCounts.hot,momentumCounts.warming,momentumCounts.cooling],backgroundColor:['#ef4444','#f59e0b','#3b82f6']}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{x:{ticks:{color:'#fff'},grid:{color:'rgba(255,255,255,0.1)'}},y:{ticks:{color:'#fff'},grid:{color:'rgba(255,255,255,0.1)'}}}}});const validTokens=allTokens.filter(t=>t.top_10_holders_pct!=null&&!isNaN(t.top_10_holders_pct)&&t.volume_24h_usd!=null&&!isNaN(t.volume_24h_usd)&&t.volume_24h_usd>0);new Chart(document.getElementById('concentrationChart'),{type:'scatter',data:{datasets:[{label:'Tokens',data:validTokens.map(t=>({x:t.top_10_holders_pct,y:Math.log10(t.volume_24h_usd+1)})),backgroundColor:validTokens.map(t=>{const colors={hot:'#ef4444',warming:'#f59e0b',cooling:'#3b82f6'};return colors[t.vol_momentum]||'#6b7280'}),pointRadius:6}]},options:{responsive:true,maintainAspectRatio:false,scales:{x:{title:{display:true,text:'Top 10%',color:'#fff'},ticks:{color:'#fff'},grid:{color:'rgba(255,255,255,0.1)'}},y:{title:{display:true,text:'Volume (log)',color:'#fff'},ticks:{color:'#fff',callback:v=>'$'+Math.pow(10,v).toFixed(0)},grid:{color:'rgba(255,255,255,0.1)'}}},plugins:{legend:{display:false}}}})}

function createPerformanceChart(){const tokenPerf={};fullHistoryData.forEach(row=>{const addr=row.address;const date=new Date(row.date);if(!tokenPerf[addr]){tokenPerf[addr]={symbol:row.symbol,prices:[]}}if(row.price_usd&&!isNaN(row.price_usd)){tokenPerf[addr].prices.push({date:date,price:row.price_usd})}});const perfData=[];Object.keys(tokenPerf).forEach(addr=>{const data=tokenPerf[addr];if(data.prices.length>=2){data.prices.sort((a,b)=>a.date-b.date);const firstPrice=data.prices[0].price;const lastPrice=data.prices[data.prices.length-1].price;if(firstPrice>0){const change=((lastPrice-firstPrice)/firstPrice)*100;perfData.push({symbol:data.symbol||addr.substring(0,8),change:change})}}});perfData.sort((a,b)=>b.change-a.change);const topGainers=perfData.slice(0,5);const topLosers=perfData.slice(-5).reverse();const combined=[...topGainers,...topLosers];if(combined.length===0)return;const ctx=document.getElementById('performanceChart');if(!ctx)return;new Chart(ctx,{type:'bar',data:{labels:combined.map(d=>d.symbol),datasets:[{label:'7-Day Change %',data:combined.map(d=>d.change),backgroundColor:combined.map(d=>d.change>0?'#10b981':'#ef4444')}]},options:{indexAxis:'y',responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false},tooltip:{callbacks:{label:function(context){return context.parsed.x.toFixed(2)+'% change'}}}},scales:{x:{title:{display:true,text:'Change %',color:'#fff'},ticks:{color:'#fff'},grid:{color:'rgba(255,255,255,0.1)'}},y:{ticks:{color:'#fff'},grid:{color:'rgba(255,255,255,0.1)'}}}}})}

function detectPatterns(){const patternsSection=document.getElementById('patternsSection');const patternsContent=document.getElementById('patternsContent');if(!patternsSection||!patternsContent)return;const hasPatternData=fullHistoryData.some(row=>row.pattern_head_shoulders||row.pattern_double_top||row.pattern_cup_handle||row.pattern_triangle);if(!hasPatternData){patternsSection.style.display='none';return}const patternCounts={'Head & Shoulders':0,'Double Top':0,'Cup & Handle':0,'Triangle':0};const tokensWithPatterns=[];const latestByToken={};fullHistoryData.forEach(row=>{const addr=row.address;const date=new Date(row.date);if(!latestByToken[addr]||new Date(latestByToken[addr].date)<date){latestByToken[addr]=row}});Object.values(latestByToken).forEach(row=>{const patterns=[];if(row.pattern_head_shoulders){patternCounts['Head & Shoulders']++;patterns.push('Head & Shoulders')}if(row.pattern_double_top){patternCounts['Double Top']++;patterns.push('Double Top')}if(row.pattern_cup_handle){patternCounts['Cup & Handle']++;patterns.push('Cup & Handle')}if(row.pattern_triangle){patternCounts['Triangle']++;patterns.push('Triangle')}if(patterns.length>0){tokensWithPatterns.push({symbol:row.symbol,name:row.name,patterns:patterns,address:row.address,volume:row.volume_24h_usd||0,risk:row.concentration_risk||'unknown'})}});if(tokensWithPatterns.length===0){patternsSection.style.display='none';return}tokensWithPatterns.sort((a,b)=>b.volume-a.volume);let html='<div style="margin-bottom: 20px;">';html+='<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px;">';Object.keys(patternCounts).forEach(pattern=>{const count=patternCounts[pattern];if(count>0){html+='<div style="background: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 10px; text-align: center;">';html+='<div style="font-size: 0.85rem; opacity: 0.7; margin-bottom: 5px;">'+pattern+'</div>';html+='<div style="font-size: 2rem; font-weight: bold;">'+count+'</div></div>'}});html+='</div>';html+='<h3 style="font-size: 1.1rem; margin-bottom: 15px;">üîç Tokens with Active Patterns</h3>';html+='<div style="display: grid; gap: 10px;">';tokensWithPatterns.slice(0,10).forEach(token=>{const riskClass='risk-'+token.risk;const riskEmoji=token.risk==='low'?'üü¢':token.risk==='medium'?'üü°':token.risk==='high'?'üü†':'üî¥';html+='<div style="background: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 10px; cursor: pointer;" ';html+='onmouseover="this.style.background=\'rgba(255, 255, 255, 0.1)\'" ';html+='onmouseout="this.style.background=\'rgba(255, 255, 255, 0.05)\'" ';html+='onclick="openTokenModal(\''+token.address+'\')">';html+='<div style="display: flex; justify-content: space-between; align-items: center;">';html+='<div><strong style="font-size: 1.1rem;">'+token.symbol+'</strong>';html+='<span style="opacity: 0.7; margin-left: 10px;">'+token.name+'</span></div>';html+='<span class="risk-badge '+riskClass+'">'+riskEmoji+' '+token.risk+'</span></div>';html+='<div style="margin-top: 10px; font-size: 0.9rem; opacity: 0.8;">üìä Patterns: '+token.patterns.join(', ')+'</div>';html+='<div style="margin-top: 5px; font-size: 0.85rem; opacity: 0.7;">üí∞ Volume: $'+token.volume.toLocaleString()+'</div>';html+='</div>'});html+='</div></div>';patternsContent.innerHTML=html;patternsSection.style.display='block'}

function enhanceModalWithPatterns(address){const tokenHistory=fullHistoryData.filter(row=>row.address===address);const latestData=tokenHistory[tokenHistory.length-1];const patternsDetected=[];if(latestData.pattern_head_shoulders)patternsDetected.push('üìä Head & Shoulders');if(latestData.pattern_double_top)patternsDetected.push('üìà Double Top');if(latestData.pattern_cup_handle)patternsDetected.push('‚òï Cup & Handle');if(latestData.pattern_triangle)patternsDetected.push('üî∫ Triangle');if(patternsDetected.length>0){const alertsDiv=document.getElementById('modalAlerts');const patternAlert='<div class="alert-box info"><strong>üéØ PATTERNS DETECTED</strong><br>'+patternsDetected.join(' ‚Ä¢ ')+'</div>';alertsDiv.innerHTML=patternAlert+alertsDiv.innerHTML}}

function renderTable(){const tbody=document.getElementById('tableBody');tbody.innerHTML='';filteredTokens.forEach(token=>{const top10=token.top_10_holders_pct??0;const liq=token.liquidity_usd??0;const vol=token.volume_24h_usd??0;const risk=token.concentration_risk||'unknown';const momentum=token.vol_momentum||'cooling';const mom3v1=token.vol_mom_3v1||0;const momentumColors={hot:'momentum-hot',warming:'momentum-warming',cooling:'momentum-cooling'};const momentumEmojis={hot:'üî•',warming:'üìà',cooling:'üìâ'};const row=tbody.insertRow();row.className='clickable-row';row.onclick=()=>openTokenModal(token.address);row.innerHTML=`<td><strong>${token.symbol||'N/A'}</strong></td><td>${token.name||'Unknown'}</td><td>${top10.toFixed(2)}%</td><td><span class="risk-badge risk-${risk}">${risk}</span></td><td>$${vol.toLocaleString()}</td><td><span class="momentum-badge ${momentumColors[momentum]}">${momentumEmojis[momentum]} ${mom3v1.toFixed(2)}x</span></td><td>$${liq.toLocaleString()}</td>`});updateResultsCount()}

function updateResultsCount(){const count=filteredTokens.length;const total=allTokens.length;document.getElementById('resultsCount').textContent=`Showing ${count} of ${total} tokens`;document.getElementById('exportCount').textContent=`(${count} tokens)`}

function sortTable(column){if(sortColumn===column){sortAscending=!sortAscending}else{sortColumn=column;sortAscending=true}filteredTokens.sort((a,b)=>{let aVal=a[column];let bVal=b[column];if(aVal==null)aVal=sortAscending?Infinity:-Infinity;if(bVal==null)bVal=sortAscending?Infinity:-Infinity;if(typeof aVal==='string'){aVal=aVal.toLowerCase();bVal=(bVal||'').toLowerCase()}return sortAscending?(aVal>bVal?1:-1):(aVal<bVal?1:-1)});renderTable()}

function setupFilters(){const riskFilter=document.getElementById('riskFilter');const momentumFilter=document.getElementById('momentumFilter');const liquidityFilter=document.getElementById('liquidityFilter');const searchFilter=document.getElementById('searchFilter');function applyFilters(){filteredTokens=allTokens.filter(token=>{const riskMatch=riskFilter.value==='all'||token.concentration_risk===riskFilter.value;const momentumMatch=momentumFilter.value==='all'||token.vol_momentum===momentumFilter.value;const liquidityMatch=!liquidityFilter.value||token.liquidity_usd>=parseFloat(liquidityFilter.value);const searchMatch=!searchFilter.value||(token.symbol||'').toLowerCase().includes(searchFilter.value.toLowerCase())||(token.name||'').toLowerCase().includes(searchFilter.value.toLowerCase());return riskMatch&&momentumMatch&&liquidityMatch&&searchMatch});renderTable()}riskFilter.addEventListener('change',applyFilters);momentumFilter.addEventListener('change',applyFilters);liquidityFilter.addEventListener('input',applyFilters);searchFilter.addEventListener('input',applyFilters)}

function exportCSV(){const csv=Papa.unparse(filteredTokens);downloadFile(csv,'solana-radar-export.csv','text/csv');showToast('‚úÖ CSV downloaded!')}

function exportJSON(){const json=JSON.stringify(filteredTokens,null,2);downloadFile(json,'solana-radar-export.json','application/json');showToast('‚úÖ JSON downloaded!')}

function copyTable(){const headers=['Symbol','Name','Top 10%','Risk','Volume','Momentum','Liquidity'];const rows=filteredTokens.map(t=>[t.symbol||'',t.name||'',(t.top_10_holders_pct||0).toFixed(2)+'%',t.concentration_risk||'','$'+(t.volume_24h_usd||0).toLocaleString(),`${t.vol_momentum||''} (${(t.vol_mom_3v1||0).toFixed(2)}x)`,'$'+(t.liquidity_usd||0).toLocaleString()]);const tsv=[headers,...rows].map(row=>row.join('\t')).join('\n');navigator.clipboard.writeText(tsv).then(()=>{showToast('‚úÖ Copied! Paste in Excel.')}).catch(()=>{showToast('‚ùå Copy failed')})}

function downloadFile(content,filename,type){const blob=new Blob([content],{type});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=filename;document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(url)}

function showToast(message){const toast=document.getElementById('toast');toast.textContent=message;toast.classList.add('show');setTimeout(()=>{toast.classList.remove('show')},3000)}

function openTokenModal(address){currentModalAddress=address;const modal=document.getElementById('tokenModal');const tokenHistory=fullHistoryData.filter(row=>row.address===address);if(tokenHistory.length===0){alert('No historical data available');return}tokenHistory.sort((a,b)=>new Date(a.date)-new Date(b.date));const latestData=tokenHistory[tokenHistory.length-1];const firstData=tokenHistory[0];document.getElementById('modalTitle').textContent=`${latestData.symbol||'Unknown'} - ${latestData.name||'Unknown'}`;document.getElementById('modalSubtitle').textContent=`${address.substring(0,8)}...${address.substring(address.length-6)}`;const daysTracked=tokenHistory.length;const firstSeen=new Date(firstData.date).toLocaleDateString();const concentrations=tokenHistory.map(d=>d.top_10_holders_pct).filter(v=>v!=null&&!isNaN(v));const firstConc=concentrations[0]||0;const lastConc=concentrations[concentrations.length-1]||0;const concChange=lastConc-firstConc;const concTrend=concChange>5?'üìà Increasing':concChange<-5?'üìâ Decreasing':'‚û°Ô∏è Stable';const currentToken=allTokens.find(t=>t.address===address);const momentum=currentToken?.vol_momentum||'unknown';const mom3v1=currentToken?.vol_mom_3v1||0;generateAlerts(tokenHistory,concChange,momentum);enhanceModalWithPatterns(address);const statsHTML=`<div class="modal-stat-card"><div class="modal-stat-label">Days Tracked</div><div class="modal-stat-value">${daysTracked}</div></div><div class="modal-stat-card"><div class="modal-stat-label">First Seen</div><div class="modal-stat-value">${firstSeen}</div></div><div class="modal-stat-card"><div class="modal-stat-label">Current Concentration</div><div class="modal-stat-value">${lastConc.toFixed(1)}%</div></div><div class="modal-stat-card"><div class="modal-stat-label">Trend</div><div class="modal-stat-value" style="font-size:1.2rem;">${concTrend}</div></div><div class="modal-stat-card"><div class="modal-stat-label">Change</div><div class="modal-stat-value" style="color:${concChange<0?'#10b981':'#ef4444'}">${concChange>0?'+':''}${concChange.toFixed(1)}%</div></div><div class="modal-stat-card"><div class="modal-stat-label">Volume Momentum</div><div class="modal-stat-value" style="font-size:1.2rem;">${momentum==='hot'?'üî•':momentum==='warming'?'üìà':'üìâ'} ${mom3v1.toFixed(2)}x</div></div><div class="modal-stat-card"><div class="modal-stat-label">Current Risk</div><div class="modal-stat-value"><span class="risk-badge risk-${latestData.concentration_risk||'unknown'}" style="font-size:0.9rem;padding:6px 14px;">${(latestData.concentration_risk||'unknown').toUpperCase()}</span></div></div>`;document.getElementById('modalStats').innerHTML=statsHTML;createModalCharts(tokenHistory);modal.style.display='block'}

function exportModalCSV(){if(!currentModalAddress)return;const tokenHistory=fullHistoryData.filter(row=>row.address===currentModalAddress);tokenHistory.sort((a,b)=>new Date(a.date)-new Date(b.date));const csv=Papa.unparse(tokenHistory);const token=allTokens.find(t=>t.address===currentModalAddress);const filename=`${token?.symbol||'token'}-history.csv`;downloadFile(csv,filename,'text/csv');showToast(`‚úÖ ${filename} downloaded!`)}

function generateAlerts(history,concChange,momentum){const alertsDiv=document.getElementById('modalAlerts');const alerts=[];if(concChange>15){alerts.push({type:'alert',title:'‚ö†Ô∏è RUG PULL RISK',message:`Concentration increased by ${concChange.toFixed(1)}% - possible whale accumulation!`})}if(concChange<-15){alerts.push({type:'info',title:'‚úÖ IMPROVING DISTRIBUTION',message:`Concentration decreased by ${Math.abs(concChange).toFixed(1)}% - better decentralization!`})}if(momentum==='hot'){alerts.push({type:'warning',title:'üî• HIGH VOLUME MOMENTUM',message:'Volume is 2x+ above average - increased trading activity detected!'})}if(history.length<=3){alerts.push({type:'warning',title:'üÜï NEW TOKEN',message:`Only ${history.length} days of data - exercise caution with new tokens.`})}if(Math.abs(concChange)<2&&history.length>7){alerts.push({type:'info',title:'‚ÑπÔ∏è STABLE PATTERN',message:'Concentration has remained stable over time.'})}alertsDiv.innerHTML=alerts.map(alert=>`<div class="alert-box ${alert.type}"><strong>${alert.title}</strong><br>${alert.message}</div>`).join('')}

function createModalCharts(history){if(modalCharts.concentration)modalCharts.concentration.destroy();if(modalCharts.priceVolume)modalCharts.priceVolume.destroy();const dates=history.map(d=>new Date(d.date).toLocaleDateString());const top10=history.map(d=>d.top_10_holders_pct??null);const top5=history.map(d=>d.top_5_holders_pct??null);const prices=history.map(d=>d.price_usd??null);const volumes=history.map(d=>d.volume_24h_usd??null);modalCharts.concentration=new Chart(document.getElementById('modalConcentrationChart'),{type:'line',data:{labels:dates,datasets:[{label:'Top 10 Holders %',data:top10,borderColor:'#ef4444',backgroundColor:'rgba(239,68,68,0.1)',tension:0.4,fill:true},{label:'Top 5 Holders %',data:top5,borderColor:'#f59e0b',backgroundColor:'rgba(245,158,11,0.1)',tension:0.4,fill:true}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{labels:{color:'#fff'}}},scales:{x:{ticks:{color:'#fff'},grid:{color:'rgba(255,255,255,0.1)'}},y:{ticks:{color:'#fff'},grid:{color:'rgba(255,255,255,0.1)'},min:0,max:100}}}});modalCharts.priceVolume=new Chart(document.getElementById('modalPriceVolumeChart'),{type:'line',data:{labels:dates,datasets:[{label:'Price (USD)',data:prices,borderColor:'#10b981',backgroundColor:'rgba(16,185,129,0.1)',yAxisID:'y',tension:0.4},{label:'24h Volume (USD)',data:volumes,borderColor:'#3b82f6',backgroundColor:'rgba(59,130,246,0.1)',yAxisID:'y1',tension:0.4}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{labels:{color:'#fff'}}},scales:{x:{ticks:{color:'#fff'},grid:{color:'rgba(255,255,255,0.1)'}},y:{type:'linear',position:'left',ticks:{color:'#fff'},grid:{color:'rgba(255,255,255,0.1)'},title:{display:true,text:'Price (USD)',color:'#fff'}},y1:{type:'linear',position:'right',ticks:{color:'#fff'},grid:{display:false},title:{display:true,text:'Volume (USD)',color:'#fff'}}}}})}

function closeModal(){document.getElementById('tokenModal').style.display='none';currentModalAddress=null}

window.onclick=function(event){const modal=document.getElementById('tokenModal');if(event.target===modal){closeModal()}}
    </script>
</body>
</html>
